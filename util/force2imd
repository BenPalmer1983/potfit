#!/bin/sh
####################################################################
#
#   Copyright 2010 Daniel Schopf
#             Institute for Theoretical and Applied Physics
#             University of Stuttgart, D-70550 Stuttgart, Germany
#             http://www.itap.physik.uni-stuttgart.de/
#
####################################################################
#
#   This file is part of potfit.
#
#   potfit is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 2 of the License, or
#   (at your option) any later version.
#
#   potfit is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with potfit; if not, write to the Free Software
#   Foundation, Inc., 51 Franklin St, Fifth Floor,
#   Boston, MA  02110-1301  USA
#
#/****************************************************************
#* $Revision: 1.1 $
#* $Date: 2010/02/04 14:34:30 $
#*****************************************************************/

if [ ! -r $mgtools/INFO/CHTAB ]; then
	echo "Could not read CHTAB.";
	exit;
fi

if [ "`grep \#C $1`" == "" ]; then
	echo "Could not find chemical species in $1";
	exit;
fi

name=(`grep \#C $1 | sed -e 's/\#C //'`);
name_array=$( printf "%s," "${name[@]}" );

echo "#F A 1 1 1 3 0 0";
echo "#C number type mass x y z";
grep \#[X-Z] $1;
echo "## Generated by force2imd from `readlink -f $1`";
echo "#E";
grep -v \# $* | awk -v name=$name_array '
BEGIN{
chfile=ENVIRON["mgtools"]"/INFO/CHTAB";
  while(getline<chfile){
    if($0 !~ /^ *\#/){sch[tolower($4)]=$2}
  }close(chfile);
  n_names=split(name,names,",")
}
{
 print i++,$1,sch[tolower(names[$1+1])],$2,$3,$4;
}'
