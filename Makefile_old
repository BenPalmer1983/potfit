MPICC  = mpicc
CC     = icc
CINCLUDE = -I/common/linux/paket/intel/mkl61/include/
MKLPATH = /common/linux/paket/intel/mkl61/lib/32/
CFLAGS = -g -O -axK  -ip  -DEAM -DSTRESS -DLIMIT #(icc) -DPOTSCALE -DPARABEL 
#CFLAGS = -g -DEAM -DLIMIT -DSTRESS # -DPARABEL -DEAM  -DLIMIT#gcc -O -g3
#CFLAGS = -O -axK -ip -g -DEAM -DSTRESS -DLIMIT -DMPI #mpicc
BINDIR = ${HOME}/bin/${HOSTTYPE}

POTFITSRC = f1dim_r.c powell_lsq.c lubksb_r.c  mprove_r.c brent_r.c ludcmp_r.c linmin_r.c mnbrak_r.c nrutil_r.c force.c config.c param.c potential.c potfit.c splines.c simann.c mpi_utils.c
POTFITHDR = potfit.h powell_lsq.h nrutil_r.h 
POTFITOBJ = $(POTFITSRC:.c=.o)

POTSCALESRC = param.c potential.c splines.c potscale.c nrutil_r.c 
POTSCALEHDR = potscale.h nrutil_r.h
POTSCALEOBJ = $(POTSCALESRC:.c=.o)

.c.o: ${POTFITHDR}
	$(CC) $(CFLAGS) $(CINCLUDE) -c $<

potfit_mpi: ${POTFITOBJ} ${POTFITHDR}
	${CC} ${CFLAGS} -o ${BINDIR}/potfit_mpi ${POTFITOBJ} -lm


#${POTFITOBJ}: $($@:.o=.c) ${POTFITHDR}
#	${CC} ${CFLAGS} -c $($@:.o=.c)
potfit_par: ${POTFITOBJ} ${POTFITHDR}
	${CC} ${CFLAGS} -o ${BINDIR}/potfit_par ${POTFITOBJ} -lm

potfit2: ${POTFITOBJ} ${POTFITHDR}
	${CC} ${CFLAGS} -o ${BINDIR}/potfit_e ${POTFITOBJ} -lm

potfit: ${POTFITOBJ} ${POTFITHDR}
	${CC} ${CFLAGS} -o ${BINDIR}/$@ ${POTFITOBJ} -lm

potfit_l: ${POTFITOBJ} ${POTFITHDR}
	${CC} ${CFLAGS} ${CINCLUDE} -o ${BINDIR}/potfit_l ${POTFITOBJ} ${MKLPATH}/libmkl_lapack.a ${MKLPATH}/libmkl_ia32.a -L${MKLPATH} -lguide -lpthread -lm
#parab:  ${POTFITOBJ} ${POTFITHDR}
#	${CC} ${CFLAGS} -DPARABEL -o ${BINDIR}/$@ ${POTFITOBJ} -lm

clean:
	rm -f *.o *~ 

neightab: neightab.c
	${CC} ${CFLAGS} -o ${BINDIR}/neightab neightab.c -lm

pottrans: pottrans.c
	${CC} ${CFLAGS} -o ${BINDIR}/pottrans pottrans.c -lm

force2poscar: force2poscar.c
	${CC} ${CFLAGS} -o ${BINDIR}/force2poscar force2poscar.c

potscale: ${POTSCALEOBJ} ${POTSCALEHDR}
	${CC} ${CFLAGS} -o ${BINDIR}/$@ ${POTSCALEOBJ} -lm

vasp2force:
	cp util/vasp2force.sh ${HOME}/bin/share
